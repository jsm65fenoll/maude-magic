# maude-magic


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

**Refs:** - [pexpect](https://pexpect.readthedocs.io/en/stable/) -
[nbdev](https://nbdev.fast.ai/tutorials/tutorial.html) - [IPython
magics](https://ipython.readthedocs.io/en/stable/config/custommagics.html) -
[Export
examples](https://nbdev1.fast.ai/export.html#Examples-of-export) - See
persistent Shells.ipynb

%%bash for package in pexpect nbdev jupyterlab-quarto do  
pip list | grep ‚Äú^$package \*" \> /dev/null && echo "$package found‚Äù ||
pip install $package done \# This must be done in terminal \#
nbdev_install_quarto

## The Maude Interpreter class

------------------------------------------------------------------------

<a
href="https://github.com/jsm65fenoll/maude-magic/blob/main/maude_magic/maude-magic.py#L9"
target="_blank" style="float:right; font-size:smaller">source</a>

### MaudeInterpreter

``` python

def MaudeInterpreter(
    debug:bool=False, trace:bool=False, timeout:int=3
):

```

*Controls maude execution, executing commands and print responses.*
Preserve sessions between different cell executions.

------------------------------------------------------------------------

### Cmd

``` python

def Cmd(
    args:VAR_POSITIONAL, kwds:VAR_KEYWORD
):

```

*Support for flags*

------------------------------------------------------------------------

### TimeoutException

``` python

def TimeoutException(
    
):

```

*Exception raised if time-out.*

``` python
def assert_print(result:tuple,type_=None,value_=None):
    # print('result=',result)

    if result:
        if not result[1]: print(result[1])
        elif type_ :  assert result[0] == type_,f"Expecting type {type_} but {result[0]} found."
        elif value_:  assert result[1] == value_,f"Expecting value {value_} but {result[1]} found."    
        else:         print(result)
```

Creating maude interpreter:

Load a maude module. Show it and make some reduction:

``` python
result= maude('load SIMPLE-NAT .')
assert_print(result)
```

Skip `quit` command:

Closing maude session on object destroy:

## The maude Magic Class

------------------------------------------------------------------------

### load_ipython_extension

``` python

def load_ipython_extension(
    ipython
):

```

*Any module file that define a function named `load_ipython_extension`*
can be loaded via `%load_ext module.path` or be configured to be
autoloaded by IPython at startup time.

------------------------------------------------------------------------

### MaudeMagics

``` python

def MaudeMagics(
    shell
):

```

*Adapts Maude Shell to a IPython Magic class.Uses a owned Maude Shell.*
Cell magics are used to execute maude commands. Line magics are used for
command line options.

Manually executing ‚Äòload_ipython_extension‚Äô for test purposes:

Now, MaudeMagic uses an owned MaudeInterpreter to run maude commands:

### Test LOAD

### Test SHOW

``` python
result = %maude show module .
assert_print(result)
```

    (None, 'SIMPLE-NAT is\n sort Nat .\n op zero : -> Nat .\n op s_ : Nat -> Nat .\n op _+_ : Nat Nat -> Nat .\n vars M N : Nat .\n eq zero + N = N .\n eq s N + M = s (N + M) .\n\n')

### Test REDUCE

``` python
result = %maude red s s 0 .
assert_print(result,'Nat','s s 0')
```

## Use cases as test

Utility function that test than a provided maude command is of sort Bool
and value = True .

def assert_true(maude_command): result = %maude red {
‚Äúhttp://perico.com‚Äù : ‚Äúhttp://perico.com‚Äù,  
‚Äúhttp://perico.com‚Äù : \[‚Äúhttp://perico.com‚Äù,‚Äúhttp://perico.com‚Äù\] } ::
ReverseMap . print(result) assert(‚Äòresult Bool: true‚Äô in result)

need to access maude interpreter instance,

### RDF Dataset

fth RDF-DATASET is

    sort RDF-Dataset .

    op <_,_> : UnnamedGraph NamedGraph* -> RDF-Dataset [ctor] .    
    op NamedGraph : ResourceIdentifier Graph odeIdentifier    
        
        
        
        sort RDF-Document .

    op serializes : RDF-Dataset -> JSON-LD-Document .
    op serializes : Property -> IRI . 


    sorts NamedGraph NamedGraph+ NamedGraph* .





    op serializes : Property -> ResourceIdentifier .     

    op namedGraph : NodeIdentifier Graph -> 
    op _-[_]->_ : SourceNode IRI Node -> Arc [ctor] . 


    IRI BlankNodeId < SourceNodeId < NodeId Literal < NodeId .   
        

### JSON-LD

#### JSON Syntax

[JSON-LD 1.1](https://www.w3.org/TR/json-ld11/#uses-of-json-objects)

``` python
fmod JSON-SORTS is
    sort Json 
    sorts  Object Array .
    subsorts Object Array < Json .    
    sort Entry .    
    op null : -> Json [ctor] .    
endfm         
  
view Json  from TRIV to JSON-SORTS is sort Elt to Json . endv
view Entry from TRIV to JSON-SORTS is sort Elt to Entry . endv

fmod JSON-ARRAY is
    protecting LIST{Json} * ( op (__) to (_,_) ) .
    op [_] : List{Json} -> Array .
    eq [nil] = null .
    op [] : -> Array [ctor] .
    eq [] = null .    
endfm

fmod JSON-OBJECT is
    protecting SET{Entry} .
    op {_} : Set{Entry} -> Object .
    eq {empty} = null .    
    
    sorts Key Value .
    op _:_ : Key Value  -> Entry [ctor] .
endfm        
             
fmod JSON is
    extending JSON-SORTS .
    protecting JSON-ARRAY .
    protecting JSON-OBJECT .        
    protecting STRING .

    subsort String  < Key Json .
    subsort Json < Value .
        
endfm
```

    None

``` python
result = %maude red "Juan" : "Perico" .
assert_print(result,'Entry')
```

``` python
result = %maude red \
{\
  "name" : "Manu Sporny" ,\
  "homepage" : "http://manu.sporny.org/" ,\
  "image" : "http://manu.sporny.org/images/manu.png"\
} .
assert_print(result,"Object")
```

``` python
result = %maude red ["Juan","Perico","Andres"] .
assert_print(result,'Array')
```

``` python
result = %maude red ["Juan",["Perico","Andres"]] .
assert_print(result,'Array','["Juan", ["Perico", "Andres"]]')
```

``` python
result = %maude red ["Juan", {"Perico" : "Andres"} ] .
assert_print(result,'Array','["Juan", {"Perico" : "Andres"}]')
```

``` python
result = %maude red {"Juan" : {"Perico" : "Andres"} } .
assert_print(result,'Object','{"Juan" : {"Perico" : "Andres"}}')
```

``` python
result = %maude red {"Juan" : ["Perico", "Andres"]} .
assert_print(result,'Object','{"Juan" : ["Perico", "Andres"]}')
```

``` python
result = %maude red \
{\
  "name" : "Manu Sporny",\
  "homepage" : "http://manu.sporny.org/",\
  "image" : "http://manu.sporny.org/images/manu.png"\
} .
assert_print(result,'Object')
```

``` python
result = %maude red \
{\
  "@context" : {\
    "name" : "http://schema.org/name",\
    "image" : {\
      "@id" : "http://schema.org/image",\
      "@type" : "@id"\
    },\
    "homepage" : {\
      "@id" : "http://schema.org/url",\
      "@type" : "@id"\
    }\
  }\
} .
assert_print(result,'Object')
```

#### IRIS

[JSON-LD 1.1](https://www.w3.org/TR/json-ld11/#terms)

``` python
fmod IRI is
protecting STRING .
sort IRI .
subsort IRI < String .
cmb S:String : IRI if find(S:String,":",0) :: NzNat .
endfm
```

    None

``` python
result = %maude red "Http://perico" .
assert_print(result,'IRI',"Http://perico")
```

#### Keywords

``` python
fmod KEYWORD is
    protecting STRING .
    sort Keyword .
    subsort Keyword < String .
    mb "@context"  : Keyword .
    mb "@id"       : Keyword .
    mb "@context"  : Keyword .
    mb "@id"       : Keyword .
    mb "@included" : Keyword .
    mb "@graph"    : Keyword .
    mb "@nest"     : Keyword .
    mb "@type"     : Keyword .
    mb "@reverse"  : Keyword .
    mb "@index"    : Keyword .
endfm
```

    None

``` python
result = %maude red "@context" . 
assert_print(result,'Keyword',"@context")
```

#### Context

``` python
fmod CONTEXT is
    protecting IRI .
    extending JSON *( sort Object to Json-Object ) .
        
    sorts TermDef Context .
    subsort TermDef < Entry .
    subsort Context < Json-Object .
        
    sorts ContextKey ContextValue .
    subsort String < ContextKey < Key .
    subsorts IRI Json-Object < ContextValue < Value .

    mb (K:ContextKey : V:ContextValue) : TermDef .
    var ... : Set{Entry} . 
    cmb { T:TermDef , ...} : Context if {...} :: Context .
    mb null : Context .
        
endfm
```

    None

``` python
#--- Example 4: Context for the sample document in the previous section
result = %maude red\
    "name" : "http://schema.org/name"\
    ***(This means that 'name' is shorthand for 'http://schema.org/name')\
.
assert_print(result,'TermDef')
```

``` python
#--- Example 4: Context for the sample document in the previous section
result = %maude red\
{\
    "name" : "http://schema.org/name"\
     ***(This means that 'name' is shorthand for 'http://schema.org/name')\
} .
print(result)
assert('result Context:' in result)
```

    None

    TypeError: argument of type 'NoneType' is not iterable
    [31m---------------------------------------------------------------------------[39m
    [31mTypeError[39m                                 Traceback (most recent call last)
    [36mCell[39m[36m [39m[32mIn[33][39m[32m, line 4[39m
    [32m      2[39m result = get_ipython().run_line_magic([33m'[39m[33mmaude[39m[33m'[39m, [33m'[39m[33mred [39m[33m{[39m[33m     [39m[33m"[39m[33mname[39m[33m"[39m[33m : [39m[33m"[39m[33mhttp://schema.org/name[39m[33m"[39m[33m      ***(This means that [39m[38;5;130;01m\'[39;00m[33mname[39m[38;5;130;01m\'[39;00m[33m is shorthand for [39m[38;5;130;01m\'[39;00m[33mhttp://schema.org/name[39m[38;5;130;01m\'[39;00m[33m) } .[39m[33m'[39m)
    [32m      3[39m [38;5;28mprint[39m(result)
    [32m----> [39m[32m4[39m [38;5;28;01massert[39;00m([33;43m'[39;49m[33;43mresult Context:[39;49m[33;43m'[39;49m[43m [49m[38;5;129;43;01min[39;49;00m[43m [49m[43mresult[49m) 

    [31mTypeError[39m: argument of type 'NoneType' is not iterable

``` python
#--- Example 4: Context for the sample document in the previous section
result = %maude red { empty } .
print(result)
assert('result Context:' in result)
```

``` python
#--- Example 4: Context for the sample document in the previous section
result = %maude red\
{\
    "@context" : {\
        "name" : "http://schema.org/name",\
        ***(  This means that 'name' is shorthand for 'http://schema.org/name')\
        "image" : {\
            "@id" : "http://schema.org/image",\
            ***(  This means that 'image' is shorthand for 'http://schema.org/image')\
            "@type" : "@id"\
            ***( This means that a string value associated with 'image')\
            ***( should be interpreted as an identifier that is an IRI)\
            },\
        "homepage" : {\
            "@id" : "http://schema.org/url",\
            ***( This means that 'homepage' is shorthand for 'http://schema.org/url')\
            "@type" : "@id"\
            ***(  This means that a string value associated with 'homepage')\
            ***(  should be interpreted as an identifier that is an IRI )\
            }\
        }\
} .
print(result)
assert('result Context:' in result)
```

#### Identifiers

[JSON-LD 1.1 / Node
Objects](https://www.w3.org/TR/json-ld11/#node-objects)

``` python
fmod IDENTIFIER is
    protecting STRING .
    protecting IRI .
    sorts BNI Compact-IRI Identifier .
    subsorts IRI Compact-IRI BNI < Identifier < String .
    var S : String .    
    cmb S : IRI  if find(S,":",0) :: Nat .    
endfm
```

``` python
result = %maude red friends:perico .
assert_print(result,'IRI')
```

``` python
fmod NODE-OBJECT-DECL is 
sort Node-Object .
endfm
```

### Graph

``` python
fmod GRAPH is 
    extending NODE-OBJECT-DECL .
    extending JSON *( sort Object to Json-Object ) .

    sorts Graph Named-Graph .
    subsorts Node-Object Named-Graph < Graph < Array .    
    subsort  Named-Graph < Json-Object .
    
    mb null : Graph .
    vars NObj NObj' NObj'' : Node-Object . var ... : List{Json} .  
    var V : Value .  var .... : Set{Entry} . 
    var Ng : Named-Graph .
     mb { "@id" : V, .... } : Named-Graph .
    cmb [ NObj , ... ] : Graph if  [ ... ] :: Graph .
endfm
```

``` python
result = %maude red "@id" : "http://www.schema.org/graph" .
print(result)   
assert('result Entry:' in result)
```

``` python
result = %maude red .... :: Set{Entry} .
print(result)
assert('result Bool: true' in result)
```

``` python
result = %maude red Ng :: Json .
print(result)
assert('result Bool: true' in result)
```

``` python
result = %maude red { "@id" : "http://www.schema.org/graph", .... } .
print(result)
assert('result Named-Graph:' in result)
```

``` python
result = %maude red [] . 
print(result)
assert('Graph: null' in result) 
result = %maude red [NObj] . 
print(result)
assert('result Graph: [NObj]' in result) 
result = %maude red [NObj, NObj' , NObj'' ] . 
print(result)
assert("result Graph: [NObj, NObj', NObj'']" in result)
```

### Reverse map

[JSON-LD 1.1 / Reverse
Properties](https://www.w3.org/TR/json-ld11/#reverse-properties)  
[JSON-LD 1.1 / Node
Object](https://www.w3.org/TR/json-ld11/#node-objects)

``` python
fmod REVERSE-MAP is 
    protecting IDENTIFIER .
    extending NODE-OBJECT-DECL .
    extending JSON *( sort Object to Map ) .

    ***(If the node object contains the @reverse key,
        its value (ReverseKeyValue) MUST be a map containing entries (ReverseProperty) 
        representing reverse properties)    
    
    sorts ReverseValue .
    subsort ReverseValue < Map . 

     mb { RP:ReverseProperty } : ReverseValue .
    cmb { RP:ReverseProperty,Rest:NeSet{Entry} } : ReverseValue if { Rest:NeSet{Entry}} : ReverseValue .  

    sort ReverseProperty .
    subsort ReverseProperty < Entry .    
    sorts ReversePropertyValue .

        
    ***(Each value of such a reverse property (ReverseProperty) MUST be an IRI reference, a compact IRI, a blank node identifier, 
        a node object or an array containing a combination of these.)
    
    mb (ReversePropertyKey:IRI : V:ReversePropertyValue) : ReverseProperty .

    subsorts Identifier Node-Object ReversePropertyValueArray  < ReversePropertyValue . 
    
    sort ReversePropertyValueArray .
    
    subsort ReversePropertyValueArray  < Array .

    var RPV : ReversePropertyValue . var .... : NeList{Json} . 
     mb [ RPV ] : ReversePropertyValueArray .       
    cmb [ RPV , .... ] : ReversePropertyValueArray if [ .... ] :: ReversePropertyValueArray .   
        
endfm
```

``` python
result = %maude red  "http://perico.com"  . 
print(result)
assert(True) 
result = %maude red  "http://perico.com" :: ReversePropertyValue . 
print(result)
assert(True) 
result = %maude red  { "http://perico.com" : "http://perico.com" } :: ReverseValue . 
print(result)
assert('result Bool: true' in result) 
result = %maude red  { "http://perico.com" : "http://perico.com", \
                       "http://perico.com" : "http://perico.com" } :: ReverseValue . 
print(result)
assert('result Bool: true' in result) 

result = %maude red  [ "http://perico.com" ] . 
print(result)

result = %maude red  [ "http://perico.com" , "http://perico.com" ] . 
print(result)
#assert('result Bool: true' in result) 



#assert('result Bool: true' in result)
```

``` python
result = %maude red \
{\
    "http://example.com/vocab#parent" : [\
      {\
        "@id" : "#bart",\
        "http://example.com/vocab#name" : "Bart"\
      }, {\
        "@id" : "#lisa",\
        "http://example.com/vocab#name" : "Lisa"\
      }\
    ]\
  } :: ReverseValue .
print(result)
assert('result Bool: true' in result)
```

### Node Object

[JSON-LD 1.1 / Node
Objects](https://www.w3.org/TR/json-ld11/#node-objects)

``` python
fmod NODE-OBJECT is
protecting KEYWORD .
protecting IDENTIFIER .
protecting JSON *( sort Object to Json-Object ) .

    

sorts Node-Object ^Node-Object .    
subsorts Node-Object ^Node-Object < Object .

sort Value .
    
var O : Object . var  N : Node-Object .
var V : Value .    
cmb O : ^Node-Object if
        ({ "@context"  : V  , ...} := O and not V :: Context         )    
     or ({ "@id"       : V  , ...} := O and not V :: Identifier      )
     or ({ "@graph"    : V  , ...} := O and not V :: Graph           )
     or ({ "@type "    : V  , ...} := O and not V :: Identifier      )
     or ({ "@reverse"  : V  , ...} := O and not V :: Reverse-Map     ) 
     or ({ "@included" : V  , ...} := O and not V :: Included-Block  )
     or ({ "@index"    : V  , ...} := O and not V :: String          )
     or ({ "@nest "    : V  , ...} := O and not V :: Property-Nesting) .

cmb O : Node-Object if not O :: ^Node-Object .
endfm
```

### Expand

fmod EXPAND is protecting CONTEXT .

    op xp : 

    op merge : Object* Object* -> Object* .
    op merge : Context Context -> Context .

    eq merge(nul,context) = context .
    eq merge(context,nul) = context .
    eq merge(term : value ,  (term : value', Object*))  = term : value', Object*  .
    eq merge(term : value ,  Object*  = term : value, Object*  [owise] .
    eq merge({Object,Object*},{Object*'}) = { merge(Object,Object*'),merge(Object*,Object*') } .     

fmod

fmod EXPAND is protecting JSON \* ( sort Object to Context ) .
protecting IDENTIFIER . protecting KEYWORD .  
sort IdOrKeyword . subsorts Identifier Keyword \> IdOrKeyword . \#
most-recently-defined-wins mechanism.

    op apply-context : Context Node-Object -> Node-Object .
    op apply-context : Object* -> Object . 

    op merge-contexts : Context Context -> Context . 
        
    ce apply-context(Ctx,{ Object* }) = { apply-context(Ctx,Object*) } [owise] .
    ce apply-context(Ctx,{ "@context" : Ctx', Object* }) = { apply-context(merge-context(Ctx,Ctx)) , Object* } 

### Terms

%%maude fmod TERM is protecting IRI . protecting Keyword .

    sort Identifier .
    subsort Iri < Identifier .
    sort IdOrKeyword .
    subsorts Identifier Keyword < IdOrKeyword .
        
    sort Term .
    subsort Term < String .
    op expand : String Context -> [URI] .
    cmb S:String : Term  if not S:String = "" 
                         /\ not S:String :: URI  
                         /\ not S:String :: Keyword 
                         /\ expand(S:String, Ctx:Context) :: IdOrKeyword .
                         /\ X:String :: Identifier or X:String :: Keyword .

endfm

### JSON-LD BASIC

%%maude fmod JSON-LD-BASIC is protecting JSON \* (sort Pair to Entry,
sort Pair+ to Entry+, sort Pair\* to Entry\*, sort Json to Value) .

    ------------------------
    sorts Term IRI Keyword .
    ------------------------    
    subsorts Term IRI Keyword < String .

    vars S : String . 
        
    cmb S : Keyword if substr(S,0,1) == "@" .
    cmb S : IRI     if find(S,":",0) =/= notFound .
    cmb S : Term    if find(S,":",0) == notFound /\ substr(S,0,1) =/= "@" .    

    ---------------------------------------------
    sorts Context_Entry Context_Entry+ Context_Entry* .
    ---------------------------------------------
    subsorts Context_Entry < Context_Entry+ < Context_Entry* .    

    subsort Context_Entry  < Entry .    
    subsort Context_Entry+ < Entry+ .    
    subsort Context_Entry* < Entry* .  
                
    mb T:Term : V:Value  : Context_Entry .   

    op _,_ : Context_Entry* Context_Entry* -> Context_Entry* [ditto] .
    op _,_ : Context_Entry* Context_Entry+ -> Context_Entry+ [ditto] .                    

    vars E : Entry . var CE* : Context_Entry* .
    cmb E : Context_Entry if "@context" : { CE* } := E .  

    ---  Context semantics:    

    vars T   : Term .
    vars Iri : IRI .
    vars V   : Value . 
    vars ... : Entry* .
        
    eq { "@context" : { T : Iri }, T : V, ...} = { "@context" : { T : Iri }, Iri : V, ...} .

    ---------------------
    sort Identity_Entry .
    ---------------------    
    subsort Identity_Entry < Entry .
        
    cmb E : Identity_Entry if "@id" : Iri := E .

    ----------------- 
    sort Type_Entry .
    -----------------
    subsort Type_Entry < Entry .

    cmb E : Type_Entry if "@type" : Iri := E .

endfm

``` python
show modules .
```

### JSON-LD_TERM

fmod JSON-LD-TERM is sort Term . sort Identifier . sort Context ,

    subsorts Context < Object .
    op expands : Term Context -> Identifier .


    subsort NodeObject NodeObject* < Json-ld < Json .

    mb { "context" : Value } : JsonLd .
    mb { "@graph"  : Value } : JsonLd .
    mb { "@context" : Value , "@graph" ; Value } : JsonLd ,

    NodeObject < Object .    
        
        

%%maude red ‚Äú@context‚Äù .  
red ‚Äúpepe‚Äù .  
red

%%maude ‚Äî Example 4 red ‚Äú@context‚Äù : { ‚Äúname‚Äù :
‚Äúhttp://schema.org/name‚Äù, ‚Äúimage‚Äù : { ‚Äú@id‚Äù : ‚Äúhttp://schema.org/image‚Äù,
‚Äú@type‚Äù : ‚Äú@id‚Äù } } .

%%maude red { ‚Äú@context‚Äù : { ‚Äúname‚Äù : ‚Äúhttp://schema.org/name‚Äù }, ‚Äúname‚Äù
: ‚ÄúManu Sporny‚Äù, ‚Äústatus‚Äù : ‚Äútrollin‚Äô‚Äù } .

### HTML

## TO-DO

- Remove trailibg newlines grom cell.

- A command that ads a path to MAUDE_LIB

- Implementar el poder acceder al Int√©rprete de maude Hacer un comando
  %maude shell de manera que haciendo la asignaci√≥n

  ``` python
  maude_shell = %maude shell
  ```

  tengamos acceso a la instancia del int√©rprete de la shell

# Nbdev Export Survey

[nbdev](https://nbdev1.fast.ai/export.html#read_nb)

``` python
from execnb.nbio import *
test_nb = read_nb('maude-magic.ipynb')
# print keys
test_nb.keys()
#Finding patterns
check_re('# export'
```
